step_counter += 1

failure_reason = str(e)

frame_url = content_frame.url if content_frame else None

step_execution_logs.append({
    "step_order": step_counter,
    "gherkin_step": step_name,
    "step_type": "WHEN",
    "action_type": action_type,
    "status": "FAIL",
    "error_message": failure_reason,

    # Frame context
    "frame_type": "content",
    "frame_url": frame_url,

    # Locator strategy (best known at failure time)
    "locator_strategy": "runtime_failure",
    "locator_value": {
        "reason": failure_reason
    },

    # Resolved element metadata (unknown on failure)
    "resolved_element_tag": None,
    "resolved_element_text": None,
    "resolved_element_id": None,
    "resolved_element_name": None,
    "resolved_element_xpath": None,

    # Input semantics
    "input_value": step_name,

    # Confidence
    "confidence": "LOW",

    "execution_ts": datetime.now().isoformat()
})
