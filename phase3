step_lower = step_name.lower()

if "click on the link" in step_lower:
    action_type = "NAV_CLICK"
elif "clicks the button" in step_lower:
    action_type = "BUTTON_CLICK"
elif "enters" in step_lower:
    action_type = "INPUT"
elif "selects" in step_lower:
    action_type = "SELECT"
else:
    raise RuntimeError("Unsupported ACTION step")


elif action_type == "BUTTON_CLICK":
    button_name = step_name.split("=")[-1].strip()
    button = content_frame.get_by_role("button", name=button_name, exact=True)
    await button.wait_for(state="visible", timeout=20000)
    await button.click()


elif action_type == "INPUT":
    value = step_name.split("'")[1]
    field_name = step_name.split("'")[-2]

    input_box = content_frame.get_by_label(field_name)
    await input_box.wait_for(state="visible", timeout=20000)
    await input_box.fill(value)


elif action_type == "SELECT":
    option_text = step_name.split("'")[1]

    # 1. Try native <select>
    select_elements = content_frame.locator("select")
    if await select_elements.count() > 0:
        select = select_elements.first
        await select.select_option(label=option_text)
        return

    # 2. Try clickable text-based dropdown (legacy CCS)
    option = content_frame.locator(f"text={option_text}")
    await option.wait_for(state="visible", timeout=20000)
    await option.click()
    return

    raise RuntimeError(f"Unable to locate dropdown option: {option_text}")

